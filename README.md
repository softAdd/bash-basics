# Основы bash-скриптов

## Что это такое?

Bash-скрипты - это сценарии командной строки, написанные для оболочки bash.<br>
Сценарии командной строки позволяют исполнять те же команды, которые можно ввести<br>
в интерактивном режиме.<br>
Интерактивный режим - оболочка читает команды, вводимые пользователем. Пользователь имеет возможность<br>
взаимодействия с оболочкой.

## Создание скриптов

Для того, чтобы создать bash-скрипт, необходимо создать файл с расширением *.sh<br>
Первой строкой необходимо указать, что этот файл является исполняемым командной оболочкой bash:<br>
`#!/bin/bash`

## Исполнение скриптов

Существует 2 основных способо вызвать bash-скрипт:<br>
1) `bash *.sh`<br>
2) `./*sh`

Для того, чтобы воспользоваться вторым способом, необходимо сначала выдать файлу правильные права:<br>
`sudo chmod a+x *.sh`

## Работа с переменными внутри скриптов

Создание простой переменной со значением (обязательно без пробелов):<br>
`myVariable="test"`

Вернуть в переменную значение команды bash:<br>
`myOs=\`uname -a\``

Использование переменной в тексте:<br>
`echo "$myOs"`

Использование переменной с командами:
`echo $myOs`

Пример простой работы с переменными:<br>
`num1=50`<br>
`num2=45`<br>
`sum=$((num1+num2))`<br>
`echo "$num1 + $num2 = $sum"`

## Параметры скриптов

Параметры скриптов - значения, переданные в файл при его вызове, например:<br>
`echo text` - вызов команды echo с параметром text.

Внутри bash-скриптов можно обращаться к специальным переменным:<br>
`$0` - хранит в себе название файла.<br>
`$` + любая цифра - переданный файлу параметр.

Пример использования:<br>
`bash *.sh hello`

*.sh:<br>
`echo $1`

Результат:<br>
`hello`

## Запуск bash-скриптов вместе с системой

Раньше было принято размещать все скрипты, которые запускаются по умолчанию в файле /etc/rc.local.<br>
Этот файл все еще существует, но это пережиток системы инициализации SysVinit и теперь он сохраняется только для совместимости.<br>
Скрипты же нужно загружать только с помощью Systemd.

Для этого достаточно создать простой юнит-файл и добавить его в автозагрузку, как любой другой сервис.<br>
Сначала создадим этот файл:<br>
`sudo vi /lib/systemd/system/runscript.service`<br>
Добавим содержимое:<br>
[Unit]<br>
Description=My Script Service<br>
After=multi-user.target

[Service]<br>
Type=idle<br>
ExecStart=/usr/bin/local/script.sh

[Install]<br>
WantedBy=multi-user.target

В секции Unit мы даем краткое описание нашему файлу и говорим с помощью опции After,<br>
что нужно запускать этот скрипт в многопользовательском режиме (multi-user).

Секция Service самая важная, здесь мы указываем тип сервиса - idle, это значит, что нужно просто запустить и забыть,<br>
вести наблюдение нет необходимости, а затем в параметре ExecStart указываем полный путь к нашему скрипту.

Осталось выставить правильные права:<br>
`sudo chmod 644 /lib/systemd/system/runscript.service`

Затем обновить конфигурацию и добавить в автозагрузку Linux новый скрипт:

`sudo systemctl daemon-reload`<br>
`sudo systemctl enable myscript.service`

После следующей перезагрузки этот скрипт будет запущен автоматически. Обратите внимание, что для каждого скрипта,<br>
который вы собираетесь запускать должны быть правильно выставлены права, а именно нужно установить флаг выполнения. Для этого используйте команду chmod:

`sudo chmod u+x /usr/local/bin/script`<br>
В параметрах мы передаем утилите адрес файла скрипта. Исполняемость - это обязательный параметр для всех способов.